{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:base",
    "security:openssf-scorecard"
  ],
  "schedule": [
    "before 6am on monday"
  ],
  "timezone": "UTC",
  "labels": [
    "dependencies"
  ],
  "assignees": [
    "@me"
  ],
  "prHourlyLimit": 2,
  "prConcurrentLimit": 5,
  "rebaseWhen": "conflicted",
  "lockFileMaintenance": {
    "enabled": false
  },
  "vulnerabilityAlerts": {
    "enabled": true,
    "automerge": true
  },
  "osvVulnerabilityAlerts": true,
  "packageRules": [
    {
      "description": "Auto-merge patch updates for base images",
      "matchManagers": ["dockerfile"],
      "matchPackageNames": ["alpine"],
      "matchUpdateTypes": ["patch"],
      "automerge": true,
      "automergeType": "pr"
    },
    {
      "description": "Group all Docker image updates",
      "matchManagers": ["dockerfile"],
      "groupName": "Docker images",
      "schedule": ["before 6am on monday"]
    },
    {
      "description": "Auto-merge GitHub Actions patch and minor updates",
      "matchManagers": ["github-actions"],
      "matchUpdateTypes": ["patch", "minor"],
      "automerge": true,
      "automergeType": "pr"
    },
    {
      "description": "Security updates - high priority",
      "matchPackagePatterns": ["*"],
      "vulnerabilityAlerts": true,
      "schedule": ["at any time"],
      "prPriority": 10,
      "automerge": true,
      "automergeType": "pr"
    },
    {
      "description": "Pin rclone and kopia versions with custom regex",
      "matchManagers": ["regex"],
      "matchFileNames": ["Dockerfile"],
      "automerge": false,
      "schedule": ["before 6am on monday"],
      "reviewers": ["@me"]
    }
  ],
  "regexManagers": [
    {
      "description": "Update rclone version in Dockerfile",
      "fileMatch": ["^Dockerfile$"],
      "matchStrings": [
        "ARG RCLONE_VERSION=(?<currentValue>.*?)\\n.*ARG KOPIA_VERSION=.*\\n.*ARG RCLONE_AMD64_SHA256=(?<currentDigest>.*?)\\n.*ARG RCLONE_ARM64_SHA256=(?<arm64Digest>.*?)\\n"
      ],
      "depNameTemplate": "rclone/rclone",
      "datasourceTemplate": "github-releases",
      "autoReplaceStringTemplate": "ARG RCLONE_VERSION={{newValue}}\nARG KOPIA_VERSION={{{kopia_version}}}\nARG RCLONE_AMD64_SHA256={{#if newDigest}}{{{newDigest}}}{{else}}{{{currentDigest}}}{{/if}}\nARG RCLONE_ARM64_SHA256={{#if newDigestArm64}}{{{newDigestArm64}}}{{else}}{{{arm64Digest}}}{{/if}}"
    },
    {
      "description": "Update kopia version in Dockerfile",
      "fileMatch": ["^Dockerfile$"],
      "matchStrings": [
        "ARG RCLONE_VERSION=.*\\n.*ARG KOPIA_VERSION=(?<currentValue>.*?)\\n.*ARG RCLONE_AMD64_SHA256=.*\\n.*ARG RCLONE_ARM64_SHA256=.*\\n.*ARG KOPIA_AMD64_SHA256=(?<currentDigest>.*?)\\n.*ARG KOPIA_ARM64_SHA256=(?<arm64Digest>.*?)\\n"
      ],
      "depNameTemplate": "kopia/kopia",
      "datasourceTemplate": "github-releases",
      "autoReplaceStringTemplate": "ARG RCLONE_VERSION={{{rclone_version}}}\nARG KOPIA_VERSION={{newValue}}\nARG RCLONE_AMD64_SHA256={{{rclone_amd64_sha}}}\nARG RCLONE_ARM64_SHA256={{{rclone_arm64_sha}}}\nARG KOPIA_AMD64_SHA256={{#if newDigest}}{{{newDigest}}}{{else}}{{{currentDigest}}}{{/if}}\nARG KOPIA_ARM64_SHA256={{#if newDigestArm64}}{{{newDigestArm64}}}{{else}}{{{arm64Digest}}}{{/if}}"
    }
  ],
  "kubernetes": {
    "fileMatch": ["^kubernetes/.*\\.yaml$", "^kubernetes/.*\\.yml$"]
  },
  "docker": {
    "enabled": true,
    "pinDigests": true
  },
  "semanticCommits": "enabled",
  "semanticCommitType": "chore",
  "semanticCommitScope": "deps",
  "ignoreTests": false,
  "ignorePaths": [
    "**/node_modules/**",
    "**/bower_components/**",
    "**/vendor/**",
    "**/.git/**"
  ]
}